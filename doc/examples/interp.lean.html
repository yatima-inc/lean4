<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="alectryon-standalone" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<title>The Well-Typed Interpreter</title>
<link rel="stylesheet" href="alectryon.css" type="text/css" />
<link rel="stylesheet" href="docutils_basic.css" type="text/css" />
<link rel="stylesheet" href="pygments.css" type="text/css" />
<script type="text/javascript" src="alectryon.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" />
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="alectryon-root alectryon-centered"><div class="alectryon-banner">Built with <a href="https://github.com/cpitclaudel/alectryon/">Alectryon</a>, running Lean4 v4.0.0-unknown. Bubbles (<span class="alectryon-bubble"></span>) indicate interactive fragments: hover for details, tap to reveal contents. Use <kbd>Ctrl+↑</kbd> <kbd>Ctrl+↓</kbd> to navigate, <kbd>Ctrl+🖱️</kbd> to focus. On Mac, use <kbd>⌘</kbd> instead of <kbd>Ctrl</kbd>.<br>Hover-Settings: Show types:<input id="toggleswitch" type="checkbox" onClick="toggleShowTypes(this);"> Show goals:<input id="toggleswitch" type="checkbox" onClick="toggleShowGoals(this);" checked><br></div><div class="document" id="the-well-typed-interpreter">
<h1 class="title">The Well-Typed Interpreter</h1>

<p>In this example, we build an interpreter for a simple functional programming language,
with variables, function application, binary operators and an <code class="highlight coq"><span class="kr">if</span><span class="o">...</span><span class="kr">then</span><span class="o">...</span><span class="kr">else</span></code> construct.
We will use the dependent type system to ensure that any programs which can be represented are well-typed.</p>
<p>Remark: this example is based on an example found in the Idris manual.</p>
<div class="section" id="vectors">
<h1>Vectors</h1>
<p>A <code class="highlight coq"><span class="n">Vector</span></code> is a list of size <code class="highlight coq"><span class="n">n</span></code> whose elements belong to a type <code class="highlight coq"><span class="n">α</span></code>.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">inductive</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Vector</var><b>: </b><span>Type u → Nat → Type u</span></span></div></blockquote></div></small></div>Vector</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>α</var><b>: </b><span>Type u</span></span></div></blockquote></div></small></div><span class="nv">α</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type u</var><b>: </b><span>Type (u + 1)</span></span></div></blockquote></div></small></div><span class="kt">Type</span> u</div><div class="alectryon-token">) : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Nat</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Nat</div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type u</var><b>: </b><span>Type (u + 1)</span></span></div></blockquote></div></small></div><span class="kt">Type</span> u</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nil</var><b>: </b><span>{α : Type u} → _root_.Vector α 0</span></span></div></blockquote></div></small></div>nil</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Vector</var><b>: </b><span>Type u → Nat → Type u</span></span></div></blockquote></div></small></div><span class="nv">Vector</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>α</var><b>: </b><span>Type u</span></span></div></blockquote></div></small></div><span class="nv">α</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>0</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">0</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>cons</var><b>: </b><span>{α : Type u} → {n : Nat} → α → _root_.Vector α n → _root_.Vector α (n + 1)</span></span></div></blockquote></div></small></div>cons</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>α</var><b>: </b><span>Type u</span></span></div></blockquote></div></small></div><span class="nv">α</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Vector</var><b>: </b><span>Type u → Nat → Type u</span></span></div></blockquote></div></small></div><span class="nv">Vector</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>α</var><b>: </b><span>Type u</span></span></div></blockquote></div></small></div><span class="nv">α</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Vector</var><b>: </b><span>Type u → Nat → Type u</span></span></div></blockquote></div></small></div><span class="nv">Vector</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>α</var><b>: </b><span>Type u</span></span></div></blockquote></div></small></div><span class="nv">α</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token"><span class="bp">+</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></div><div class="alectryon-token">)</div></span></pre><p>We can overload the <code class="highlight coq"><span class="n">List</span><span class="o">.</span><span class="n">cons</span></code> notation <code class="highlight coq"><span class="o">::</span></code> and use it to create <code class="highlight coq"><span class="n">Vector</span></code>s.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">infix</span></div><div class="alectryon-token">:<span class="mi">67</span> <span class="s2">&quot; :: &quot;</span> <span class="bp">=&gt;</span> Vector.cons</div></span></pre><p>Now, we define the types of our simple functional language.
We have integers, booleans, and functions, represented by <code class="highlight coq"><span class="n">Ty</span></code>.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">inductive</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">where</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>int</var><b>: </b><span>_root_.Ty</span></span></div></blockquote></div></small></div>int</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>bool</var><b>: </b><span>_root_.Ty</span></span></div></blockquote></div></small></div>bool</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>_root_.Ty → _root_.Ty → _root_.Ty</span></span></div></blockquote></div></small></div>fn</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>r</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">r</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Sort _tmp_ind_univ_param</span></span></div></blockquote></div></small></div><span class="nv">Ty</span></div><div class="alectryon-token">)</div></span></pre><p>We can write a function to translate <code class="highlight coq"><span class="n">Ty</span></code> values to a Lean type
— remember that types are first class, so can be calculated just like any other value.
We mark <code class="highlight coq"><span class="n">Ty</span><span class="o">.</span><span class="n">interp</span></code> as <code class="highlight coq"><span class="o">[</span><span class="n">reducible</span><span class="o">]</span></code> to make sure the typeclass resolution procedure can
unfold/reduce it. For example, suppose Lean is trying to synthesize a value for the instance
<code class="highlight coq"><span class="kn">Add</span> <span class="o">(</span><span class="n">Ty</span><span class="o">.</span><span class="n">interp</span> <span class="n">Ty</span><span class="o">.</span><span class="n">int</span><span class="o">)</span></code>. Since <code class="highlight coq"><span class="n">Ty</span><span class="o">.</span><span class="n">interp</span></code> is marked as <code class="highlight coq"><span class="o">[</span><span class="n">reducible</span><span class="o">],</span>
<span class="n">the</span> <span class="n">typeclass</span> <span class="n">resolution</span> <span class="n">procedure</span> <span class="n">can</span> <span class="n">reduce</span> <span class="o">`</span><span class="n">Ty</span><span class="o">.</span><span class="n">interp</span> <span class="n">Ty</span><span class="o">.</span><span class="n">int</span></code> to <code class="highlight coq"><span class="n">Int</span></code>, and use
the builtin instance for <code class="highlight coq"><span class="kn">Add</span> <span class="n">Int</span></code> as the solution.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">@[reducible]</span> </div><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.interp</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div>Ty.interp</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>int</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>int</div><div class="alectryon-token">    <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Int</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Int</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>bool</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>bool</div><div class="alectryon-token">   <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Bool</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Bool</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div>fn</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>r</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">r</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">interp</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>r</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">r</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">interp</span></div><div class="alectryon-token"></div></span></pre><p>Expressions are indexed by the types of the local variables, and the type of the expression itself.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">inductive</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>HasType</var><b>: </b><span>{n : Nat} → Fin n → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div>HasType</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Fin</var><b>: </b><span>Nat → Type</span></span></div></blockquote></div></small></div>Fin</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Vector</var><b>: </b><span>Type → Nat → Type</span></span></div></blockquote></div></small></div>Vector</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">where</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>stop</var><b>: </b><span>{ty : Ty} → {x : Nat} → {ctx : Vector Ty x} → _root_.HasType 0 (ty :: ctx) ty</span></span></div></blockquote></div></small></div>stop</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>HasType</var><b>: </b><span>{n : Nat} → Fin n → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">HasType</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>0</var><b>: </b><span>Fin (?m.2010 + 1)</span></span></div></blockquote></div></small></div><span class="mi">0</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"> :: </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.2010</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token">) </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pop</var><b>: </b><span>{x : Nat} →
  {k : Fin x} → {ctx : Vector Ty x} → {ty u : Ty} → _root_.HasType k ctx ty → _root_.HasType (Fin.succ k) (u :: ctx) ty</span></span></div></blockquote></div></small></div>pop</div><div class="alectryon-token">  : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>HasType</var><b>: </b><span>{n : Nat} → Fin n → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">HasType</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k</var><b>: </b><span>Fin ?m.2127</span></span></div></blockquote></div></small></div><span class="nv">k</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.2127</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>HasType</var><b>: </b><span>{n : Nat} → Fin n → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">HasType</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k</var><b>: </b><span>Fin ?m.2127</span></span></div></blockquote></div></small></div><span class="nv">k</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>succ</var><b>: </b><span>{n : Nat} → Fin n → Fin (Nat.succ n)</span></span></div></blockquote></div></small></div>succ</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>u</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">u</span></div><div class="alectryon-token"> :: </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.2127</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token">) </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token">

</div><div class="alectryon-token"><span class="kd">inductive</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div>Expr</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Vector</var><b>: </b><span>Type → Nat → Type</span></span></div></blockquote></div></small></div>Vector</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">where</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{x : Nat} → {i : Fin x} → {ctx : Vector Ty x} → {ty : Ty} → HasType i ctx ty → _root_.Expr ctx ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token">   : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>HasType</var><b>: </b><span>{n : Nat} → Fin n → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div>HasType</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>Fin ?m.2962</span></span></div></blockquote></div></small></div><span class="nv">i</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.2962</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.2962</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>val</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → Int → _root_.Expr ctx Ty.int</span></span></div></blockquote></div></small></div>val</div><div class="alectryon-token">   : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Int</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Int</div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.2978</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.int</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>Ty.int</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{a : Ty} → {x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → _root_.Expr (a :: ctx) ty → _root_.Expr ctx (Ty.fn a ty)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token">   : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> :: </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.3072</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token">) </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.3072</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div>Ty.fn</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token">)
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {a ty : Ty} → _root_.Expr ctx (Ty.fn a ty) → _root_.Expr ctx a → _root_.Expr ctx ty</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token">   : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.3156</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div>Ty.fn</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token">) <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.3156</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.3156</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>op</var><b>: </b><span>{x : Nat} →
  {ctx : Vector Ty x} →
    {a b c : Ty} → (Ty.interp a → Ty.interp b → Ty.interp c) → _root_.Expr ctx a → _root_.Expr ctx b → _root_.Expr ctx c</span></span></div></blockquote></div></small></div>op</div><div class="alectryon-token">    : (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div>interp</div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div>interp</div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>c</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">c</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div>interp</div><div class="alectryon-token">) <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.3240</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.3240</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.3240</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>c</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">c</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ife</var><b>: </b><span>{x : Nat} →
  {ctx : Vector Ty x} → {a : Ty} → _root_.Expr ctx Ty.bool → _root_.Expr ctx a → _root_.Expr ctx a → _root_.Expr ctx a</span></span></div></blockquote></div></small></div>ife</div><div class="alectryon-token">   : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.3333</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.bool</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>Ty.bool</div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.3333</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.3333</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.3333</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>delay</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {a : Ty} → (Unit → _root_.Expr ctx a) → _root_.Expr ctx a</span></span></div></blockquote></div></small></div>delay</div><div class="alectryon-token"> : (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Unit</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Unit</div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.3370</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">) <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div><span class="nv">Expr</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.3370</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"></div></span></pre><p>We use the command <code class="highlight coq"><span class="n">open</span></code> to create the aliases <code class="highlight coq"><span class="n">stop</span></code> and <code class="highlight coq"><span class="n">pop</span></code> for <code class="highlight coq"><span class="n">HasType</span><span class="o">.</span><span class="n">stop</span></code> and <code class="highlight coq"><span class="n">HasType</span><span class="o">.</span><span class="n">pop</span></code> respectively.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kn">open</span></div><div class="alectryon-token"> HasType (stop pop)</div></span></pre><p>Since expressions are indexed by their type, we can read the typing rules of the language from the definitions of the constructors.
Let us look at each constructor in turn.</p>
<p>We use a nameless representation for variables — they are de Bruijn indexed.
Variables are represented by a proof of their membership in the context, <code class="highlight coq"><span class="n">HasType</span> <span class="n">i</span> <span class="n">ctx</span> <span class="n">ty</span></code>,
which is a proof that variable <code class="highlight coq"><span class="n">i</span></code> in context <code class="highlight coq"><span class="n">ctx</span></code> has type <code class="highlight coq"><span class="n">ty</span></code>.</p>
<p>We can treat <code class="highlight coq"><span class="n">stop</span></code> as a proof that the most recently defined variable is well-typed,
and <code class="highlight coq"><span class="n">pop</span> <span class="n">n</span></code> as a proof that, if the <code class="highlight coq"><span class="n">n</span><span class="o">`</span><span class="n">th</span> <span class="n">most</span> <span class="n">recently</span> <span class="n">defined</span> <span class="n">variable</span> <span class="kr">is</span> <span class="n">well</span><span class="o">-</span><span class="n">typed</span><span class="o">,</span> <span class="n">so</span> <span class="kr">is</span> <span class="n">the</span> <span class="o">`</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="o">`</span><span class="n">th</span><span class="o">.</span>
<span class="n">In</span> <span class="n">practice</span><span class="o">,</span> <span class="n">this</span> <span class="n">means</span> <span class="n">we</span> <span class="n">use</span> <span class="o">`</span><span class="n">stop</span></code> to refer to the most recently defined variable,
<code class="highlight coq"><span class="n">pop</span> <span class="n">stop</span></code> to refer to the next, and so on, via the <code class="highlight coq"><span class="n">Expr</span><span class="o">.</span><span class="n">var</span></code> constructor.</p>
<p>A value <code class="highlight coq"><span class="n">Expr</span><span class="o">.</span><span class="n">val</span></code> carries a concrete representation of an integer.</p>
<p>A lambda <code class="highlight coq"><span class="n">Expr</span><span class="o">.</span><span class="n">lam</span></code> creates a function. In the scope of a function ot type <code class="highlight coq"><span class="n">Ty</span><span class="o">.</span><span class="n">fn</span> <span class="n">a</span> <span class="n">ty</span></code>, there is a
new local variable of type <code class="highlight coq"><span class="n">a</span></code>.</p>
<p>A function application <code class="highlight coq"><span class="n">Expr</span><span class="o">.</span><span class="n">app</span></code> produces a value of type <code class="highlight coq"><span class="n">ty</span></code> given a function from <code class="highlight coq"><span class="n">a</span></code> to <code class="highlight coq"><span class="n">ty</span></code> and a value of type <code class="highlight coq"><span class="n">a</span></code>.</p>
<p>The constructor <code class="highlight coq"><span class="n">Expr</span><span class="o">.</span><span class="n">op</span></code> allows us to use arbitrary binary operators, where the type of the operator informs what the types of the arguments must be.</p>
<p>Finally, the constructor <code class="highlight coq"><span class="n">Exp</span><span class="o">.</span><span class="n">ife</span></code> represents a <code class="highlight coq"><span class="kr">if</span><span class="o">-</span><span class="kr">then</span><span class="o">-</span><span class="kr">else</span></code> expression. The condition is a Boolean, and each branch must have the same type.</p>
<p>The auxiliary constructor <code class="highlight coq"><span class="n">Expr</span><span class="o">.</span><span class="n">delay</span></code> is used to delay evaluation.</p>
<p>When we evaluate an <code class="highlight coq"><span class="n">Expr</span></code>, we’ll need to know the values in scope, as well as their types. <code class="highlight coq"><span class="n">Env</span></code> is an environment,
indexed over the types in scope. Since an environment is just another form of list, albeit with a strongly specified connection
to the vector of local variable types, we overload again the notation <code class="highlight coq"><span class="o">::</span></code> so that we can use the usual list syntax.
Given a proof that a variable is defined in the context, we can then produce a value from the environment.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">inductive</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Env</var><b>: </b><span>{n : Nat} → Vector Ty n → Type</span></span></div></blockquote></div></small></div>Env</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Vector</var><b>: </b><span>Type → Nat → Type</span></span></div></blockquote></div></small></div>Vector</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">where</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nil</var><b>: </b><span>_root_.Env Vector.nil</span></span></div></blockquote></div></small></div>nil</div><div class="alectryon-token">  : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Env</var><b>: </b><span>{n : Nat} → Vector Ty n → Type</span></span></div></blockquote></div></small></div><span class="nv">Env</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Vector.nil</var><b>: </b><span>{α : Type} → Vector α 0</span></span></div></blockquote></div></small></div>Vector.nil</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>cons</var><b>: </b><span>{a : Ty} → {x : Nat} → {ctx : Vector Ty x} → Ty.interp a → _root_.Env ctx → _root_.Env (a :: ctx)</span></span></div></blockquote></div></small></div>cons</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.interp</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div>Ty.interp</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Env</var><b>: </b><span>{n : Nat} → Vector Ty n → Type</span></span></div></blockquote></div></small></div><span class="nv">Env</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.7898</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Env</var><b>: </b><span>{n : Nat} → Vector Ty n → Type</span></span></div></blockquote></div></small></div><span class="nv">Env</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> :: </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.7898</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token">)

</div><div class="alectryon-token"><span class="kd">infix</span></div><div class="alectryon-token">:<span class="mi">67</span> <span class="s2">&quot; :: &quot;</span> <span class="bp">=&gt;</span> Env.cons

</div><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Env.lookup</var><b>: </b><span>{x : Nat} → {i : Fin x} → {ctx : Vector Ty x} → {ty : Ty} → HasType i ctx ty → Env ctx → Ty.interp ty</span></span></div></blockquote></div></small></div>Env.lookup</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>HasType</var><b>: </b><span>{n : Nat} → Fin n → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div>HasType</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>Fin ?m.9666</span></span></div></blockquote></div></small></div><span class="nv">i</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.9666</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Env</var><b>: </b><span>{n : Nat} → Vector Ty n → Type</span></span></div></blockquote></div></small></div>Env</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.9666</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div>interp</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>stop</var><b>: </b><span>{ty : Ty} → {x : Nat} → {ctx : Vector Ty x} → HasType 0 (ty :: ctx) ty</span></span></div></blockquote></div></small></div>stop</div><div class="alectryon-token">,  </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Ty.interp ty</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> :: </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>xs</var><b>: </b><span>Env ?m.9966</span></span></div></blockquote></div></small></div><span class="nv">xs</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Ty.interp ty</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pop</var><b>: </b><span>{x : Nat} → {k : Fin x} → {ctx : Vector Ty x} → {ty u : Ty} → HasType k ctx ty → HasType (Fin.succ k) (u :: ctx) ty</span></span></div></blockquote></div></small></div>pop</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k</var><b>: </b><span>HasType ?m.10362 ?m.10368 ty</span></span></div></blockquote></div></small></div><span class="nv">k</span></div><div class="alectryon-token">, </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Ty.interp ?m.10369</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> :: </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>xs</var><b>: </b><span>Env ?m.10368</span></span></div></blockquote></div></small></div><span class="nv">xs</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lookup</var><b>: </b><span>{x : Nat} → {i : Fin x} → {ctx : Vector Ty x} → {ty : Ty} → HasType i ctx ty → Env ctx → Ty.interp ty</span></span></div></blockquote></div></small></div><span class="nv">lookup</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>k</var><b>: </b><span>HasType x✝² x✝¹ ty</span></span></div></blockquote></div></small></div><span class="nv">k</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>xs</var><b>: </b><span>Env x✝¹</span></span></div></blockquote></div></small></div><span class="nv">xs</span></div><div class="alectryon-token"></div></span></pre><p>Given this, an interpreter is a function which translates an <code class="highlight coq"><span class="n">Expr</span></code> into a Lean value with respect to a specific environment.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr.interp</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Env ctx → Expr ctx ty → Ty.interp ty</span></span></div></blockquote></div></small></div>Expr.interp</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>env</var><b>: </b><span>Env ctx</span></span></div></blockquote></div></small></div><span class="nv">env</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Env</var><b>: </b><span>{n : Nat} → Vector Ty n → Type</span></span></div></blockquote></div></small></div>Env</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.12524</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token">) : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div>Expr</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.12524</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"> <span class="bp">→</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>Ty → Type</span></span></div></blockquote></div></small></div>interp</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{x : Nat} → {i : Fin x} → {ctx : Vector Ty x} → {ty : Ty} → HasType i ctx ty → Expr ctx ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>HasType ?m.12796 ctx ?ty</span></span></div></blockquote></div></small></div><span class="nv">i</span></div><div class="alectryon-token">     <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>env</var><b>: </b><span>Env ctx</span></span></div></blockquote></div></small></div><span class="nv">env</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lookup</var><b>: </b><span>{x : Nat} → {i : Fin x} → {ctx : Vector Ty x} → {ty : Ty} → HasType i ctx ty → Env ctx → Ty.interp ty</span></span></div></blockquote></div></small></div>lookup</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>HasType x✝ ctx ty</span></span></div></blockquote></div></small></div><span class="nv">i</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>val</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → Int → Expr ctx Ty.int</span></span></div></blockquote></div></small></div>val</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Int</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">     <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Int</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{a : Ty} → {x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Expr (a :: ctx) ty → Expr ctx (Ty.fn a ty)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Expr (?m.12872 :: ctx) ?m.12873</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token">     <span class="bp">=&gt;</span> </div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Ty.interp x✝¹</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Expr (x✝¹ :: ctx) x✝</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Env ctx → Expr ctx ty → Ty.interp ty</span></span></div></blockquote></div></small></div><span class="nv">interp</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Env.cons</var><b>: </b><span>{a : Ty} → {x : Nat} → {ctx : Vector Ty x} → Ty.interp a → Env ctx → Env (a :: ctx)</span></span></div></blockquote></div></small></div>Env.cons</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Ty.interp x✝¹</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>env</var><b>: </b><span>Env ctx</span></span></div></blockquote></div></small></div><span class="nv">env</span></div><div class="alectryon-token">)
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {a ty : Ty} → Expr ctx (Ty.fn a ty) → Expr ctx a → Expr ctx ty</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Expr ctx (Ty.fn ?m.12974 ?ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Expr ctx ?m.12974</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">   <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Expr ctx (Ty.fn x✝ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Env ctx → Expr ctx ty → Ty.interp ty</span></span></div></blockquote></div></small></div><span class="nv">interp</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>env</var><b>: </b><span>Env ctx</span></span></div></blockquote></div></small></div><span class="nv">env</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Expr ctx x✝</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Env ctx → Expr ctx ty → Ty.interp ty</span></span></div></blockquote></div></small></div><span class="nv">interp</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>env</var><b>: </b><span>Env ctx</span></span></div></blockquote></div></small></div><span class="nv">env</span></div><div class="alectryon-token">)
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>op</var><b>: </b><span>{x : Nat} →
  {ctx : Vector Ty x} → {a b c : Ty} → (Ty.interp a → Ty.interp b → Ty.interp c) → Expr ctx a → Expr ctx b → Expr ctx c</span></span></div></blockquote></div></small></div>op</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>o</var><b>: </b><span>Ty.interp ?m.13086 → Ty.interp ?m.13087 → Ty.interp ?ty</span></span></div></blockquote></div></small></div><span class="nv">o</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Expr ctx ?m.13086</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>y</var><b>: </b><span>Expr ctx ?m.13087</span></span></div></blockquote></div></small></div><span class="nv">y</span></div><div class="alectryon-token">  <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>o</var><b>: </b><span>Ty.interp x✝¹ → Ty.interp x✝ → Ty.interp ty</span></span></div></blockquote></div></small></div><span class="nv">o</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Expr ctx x✝¹</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Env ctx → Expr ctx ty → Ty.interp ty</span></span></div></blockquote></div></small></div><span class="nv">interp</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>env</var><b>: </b><span>Env ctx</span></span></div></blockquote></div></small></div><span class="nv">env</span></div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>y</var><b>: </b><span>Expr ctx x✝</span></span></div></blockquote></div></small></div><span class="nv">y</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Env ctx → Expr ctx ty → Ty.interp ty</span></span></div></blockquote></div></small></div><span class="nv">interp</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>env</var><b>: </b><span>Env ctx</span></span></div></blockquote></div></small></div><span class="nv">env</span></div><div class="alectryon-token">)
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ife</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {a : Ty} → Expr ctx Ty.bool → Expr ctx a → Expr ctx a → Expr ctx a</span></span></div></blockquote></div></small></div>ife</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>c</var><b>: </b><span>Expr ctx Ty.bool</span></span></div></blockquote></div></small></div><span class="nv">c</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t</var><b>: </b><span>Expr ctx ?ty</span></span></div></blockquote></div></small></div><span class="nv">t</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Expr ctx ?ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><span class="k">if</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>c</var><b>: </b><span>Expr ctx Ty.bool</span></span></div></blockquote></div></small></div><span class="nv">c</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Env ctx → Expr ctx ty → Ty.interp ty</span></span></div></blockquote></div></small></div><span class="nv">interp</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>env</var><b>: </b><span>Env ctx</span></span></div></blockquote></div></small></div><span class="nv">env</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">then</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>t</var><b>: </b><span>Expr ctx ty</span></span></div></blockquote></div></small></div><span class="nv">t</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Env ctx → Expr ctx ty → Ty.interp ty</span></span></div></blockquote></div></small></div><span class="nv">interp</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>env</var><b>: </b><span>Env ctx</span></span></div></blockquote></div></small></div><span class="nv">env</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">else</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Expr ctx ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Env ctx → Expr ctx ty → Ty.interp ty</span></span></div></blockquote></div></small></div><span class="nv">interp</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>env</var><b>: </b><span>Env ctx</span></span></div></blockquote></div></small></div><span class="nv">env</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>delay</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {a : Ty} → (Unit → Expr ctx a) → Expr ctx a</span></span></div></blockquote></div></small></div>delay</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Unit → Expr ctx ?ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">   <span class="bp">=&gt;</span> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Unit → Expr ctx ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>()</var><b>: </b><span>Unit</span></span></div></blockquote></div></small></div>()</div><div class="alectryon-token">)<span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Env ctx → Expr ctx ty → Ty.interp ty</span></span></div></blockquote></div></small></div><span class="na">interp</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>env</var><b>: </b><span>Env ctx</span></span></div></blockquote></div></small></div><span class="nv">env</span></div><div class="alectryon-token">

</div><div class="alectryon-token"><span class="kn">open</span></div><div class="alectryon-token"> Expr</div></span></pre><p>We can make some simple test functions. Firstly, adding two inputs <code class="highlight coq"><span class="kr">fun</span> <span class="nv">x</span> <span class="nv">y</span> <span class="o">=&gt;</span> <span class="n">y</span> <span class="o">+</span> <span class="n">x</span></code> is written as follows.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>add</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → Expr ctx (Ty.fn Ty.int (Ty.fn Ty.int Ty.int))</span></span></div></blockquote></div></small></div>add</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div>Expr</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.16829</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div>Ty.fn</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.int</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>Ty.int</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div>Ty.fn</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.int</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>Ty.int</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.int</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>Ty.int</div><div class="alectryon-token">)) :=
  </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{a : Ty} → {x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Expr (a :: ctx) ty → Expr ctx (Ty.fn a ty)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{a : Ty} → {x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Expr (a :: ctx) ty → Expr ctx (Ty.fn a ty)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>op</var><b>: </b><span>{x : Nat} →
  {ctx : Vector Ty x} → {a b c : Ty} → (Ty.interp a → Ty.interp b → Ty.interp c) → Expr ctx a → Expr ctx b → Expr ctx c</span></span></div></blockquote></div></small></div>op</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>(.+.)</var><b>: </b><span>Ty.interp Ty.int → Ty.interp Ty.int → Ty.interp Ty.int</span></span></div></blockquote></div></small></div>(<span class="bp">.+.</span>)</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{x : Nat} → {i : Fin x} → {ctx : Vector Ty x} → {ty : Ty} → HasType i ctx ty → Expr ctx ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>stop</var><b>: </b><span>{ty : Ty} → {x : Nat} → {ctx : Vector Ty x} → HasType 0 (ty :: ctx) ty</span></span></div></blockquote></div></small></div>stop</div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{x : Nat} → {i : Fin x} → {ctx : Vector Ty x} → {ty : Ty} → HasType i ctx ty → Expr ctx ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pop</var><b>: </b><span>{x : Nat} → {k : Fin x} → {ctx : Vector Ty x} → {ty u : Ty} → HasType k ctx ty → HasType (Fin.succ k) (u :: ctx) ty</span></span></div></blockquote></div></small></div>pop</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>stop</var><b>: </b><span>{ty : Ty} → {x : Nat} → {ctx : Vector Ty x} → HasType 0 (ty :: ctx) ty</span></span></div></blockquote></div></small></div>stop</div><div class="alectryon-token">))))

</div></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="zj3m6sqkz7hm4s4q0v7hcapsrjw6biml-interp-lean-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="zj3m6sqkz7hm4s4q0v7hcapsrjw6biml-interp-lean-chk0"><div class="alectryon-token"><span class="k">#eval</span></div></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message"><span class="mi">30</span>
</blockquote></div></div></small></span><span class="alectryon-wsp"><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>add</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → Expr ctx (Ty.fn Ty.int (Ty.fn Ty.int Ty.int))</span></span></div></blockquote></div></small></div>add</div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Env ctx → Expr ctx ty → Ty.interp ty</span></span></div></blockquote></div></small></div>interp</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Env.nil</var><b>: </b><span>Env Vector.nil</span></span></div></blockquote></div></small></div>Env.nil</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>10</var><b>: </b><span>Ty.interp Ty.int</span></span></div></blockquote></div></small></div><span class="mi">10</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>20</var><b>: </b><span>Ty.interp Ty.int</span></span></div></blockquote></div></small></div><span class="mi">20</span></div><div class="alectryon-token"></div></span></pre><p>More interestingly, a factorial function fact (e.g. <code class="highlight coq"><span class="kr">fun</span> <span class="nv">x</span> <span class="o">=&gt;</span> <span class="kr">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="kr">then</span> <span class="mi">1</span> <span class="kr">else</span> <span class="o">(</span><span class="n">fact</span> <span class="o">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="n">x</span><span class="o">)</span></code>), can be written as.
Note that this is a recursive (non-terminating) definition. For every input value, the interpreter terminates, but the
definition itself is non-terminating. We use two tricks to make sure Lean accepts it. First, we use the auxiliary constructor
<code class="highlight coq"><span class="n">Expr</span><span class="o">.</span><span class="n">delay</span></code> to delay its unfolding. Second, we add the annotation <code class="highlight coq"><span class="n">decreasing_by</span> <span class="n">sorry</span></code> which can be viwed as
&quot;trust me, this recursive definition makes sense&quot;. Recall that <code class="highlight coq"><span class="n">sorry</span></code> is an unsound axiom in Lean.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fact</var><b>: </b><span>(_x : (x : Nat) ×' Vector Ty x) → Expr _x.2 (Ty.fn Ty.int Ty.int)</span></span></div></blockquote></div></small></div>fact</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Expr</var><b>: </b><span>{n : Nat} → Vector Ty n → Ty → Type</span></span></div></blockquote></div></small></div>Expr</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ctx</var><b>: </b><span>Vector Ty ?m.17215</span></span></div></blockquote></div></small></div><span class="nv">ctx</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.fn</var><b>: </b><span>Ty → Ty → Ty</span></span></div></blockquote></div></small></div>Ty.fn</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.int</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>Ty.int</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.int</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>Ty.int</div><div class="alectryon-token">) :=
  </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{a : Ty} → {x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Expr (a :: ctx) ty → Expr ctx (Ty.fn a ty)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ife</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {a : Ty} → Expr ctx Ty.bool → Expr ctx a → Expr ctx a → Expr ctx a</span></span></div></blockquote></div></small></div>ife</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>op</var><b>: </b><span>{x : Nat} →
  {ctx : Vector Ty x} → {a b c : Ty} → (Ty.interp a → Ty.interp b → Ty.interp c) → Expr ctx a → Expr ctx b → Expr ctx c</span></span></div></blockquote></div></small></div>op</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>(.==.)</var><b>: </b><span>Ty.interp Ty.int → Ty.interp Ty.int → Bool</span></span></div></blockquote></div></small></div>(<span class="bp">.==.</span>)</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{x : Nat} → {i : Fin x} → {ctx : Vector Ty x} → {ty : Ty} → HasType i ctx ty → Expr ctx ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>stop</var><b>: </b><span>{ty : Ty} → {x : Nat} → {ctx : Vector Ty x} → HasType 0 (ty :: ctx) ty</span></span></div></blockquote></div></small></div>stop</div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>val</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → Int → Expr ctx Ty.int</span></span></div></blockquote></div></small></div>val</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>0</var><b>: </b><span>Int</span></span></div></blockquote></div></small></div><span class="mi">0</span></div><div class="alectryon-token">))
           (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>val</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → Int → Expr ctx Ty.int</span></span></div></blockquote></div></small></div>val</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Int</span></span></div></blockquote></div></small></div><span class="mi">1</span></div><div class="alectryon-token">)
           (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>op</var><b>: </b><span>{x : Nat} →
  {ctx : Vector Ty x} → {a b c : Ty} → (Ty.interp a → Ty.interp b → Ty.interp c) → Expr ctx a → Expr ctx b → Expr ctx c</span></span></div></blockquote></div></small></div>op</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>(.*.)</var><b>: </b><span>Ty.interp Ty.int → Ty.interp Ty.int → Ty.interp Ty.int</span></span></div></blockquote></div></small></div>(<span class="bp">.*.</span>)</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>delay</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {a : Ty} → (Unit → Expr ctx a) → Expr ctx a</span></span></div></blockquote></div></small></div>delay</div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>_</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>_</div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {a ty : Ty} → Expr ctx (Ty.fn a ty) → Expr ctx a → Expr ctx ty</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fact</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → Expr ctx (Ty.fn Ty.int Ty.int)</span></span></div></blockquote></div></small></div><span class="nv">fact</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>op</var><b>: </b><span>{x : Nat} →
  {ctx : Vector Ty x} → {a b c : Ty} → (Ty.interp a → Ty.interp b → Ty.interp c) → Expr ctx a → Expr ctx b → Expr ctx c</span></span></div></blockquote></div></small></div>op</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>(.-.)</var><b>: </b><span>Ty.interp Ty.int → Ty.interp Ty.int → Ty.interp Ty.int</span></span></div></blockquote></div></small></div>(<span class="bp">.-.</span>)</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{x : Nat} → {i : Fin x} → {ctx : Vector Ty x} → {ty : Ty} → HasType i ctx ty → Expr ctx ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>stop</var><b>: </b><span>{ty : Ty} → {x : Nat} → {ctx : Vector Ty x} → HasType 0 (ty :: ctx) ty</span></span></div></blockquote></div></small></div>stop</div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>val</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → Int → Expr ctx Ty.int</span></span></div></blockquote></div></small></div>val</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Int</span></span></div></blockquote></div></small></div><span class="mi">1</span></div><div class="alectryon-token">))) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{x : Nat} → {i : Fin x} → {ctx : Vector Ty x} → {ty : Ty} → HasType i ctx ty → Expr ctx ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>stop</var><b>: </b><span>{ty : Ty} → {x : Nat} → {ctx : Vector Ty x} → HasType 0 (ty :: ctx) ty</span></span></div></blockquote></div></small></div>stop</div><div class="alectryon-token">)))
  </div><div class="alectryon-token"><span class="k">decreasing_by</span></div><div class="alectryon-token"> </div></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="zj3m6sqkz7hm4s4q0v7hcapsrjw6biml-interp-lean-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="zj3m6sqkz7hm4s4q0v7hcapsrjw6biml-interp-lean-chk1"><div class="alectryon-token"><span class="gr">sorry</span></div></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Warning: declaration uses <span class="bp">&#39;</span><span class="gr">sorry</span><span class="bp">&#39;</span></blockquote></div></div></small></span><span class="alectryon-wsp"><div class="alectryon-token">

</div></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="zj3m6sqkz7hm4s4q0v7hcapsrjw6biml-interp-lean-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="zj3m6sqkz7hm4s4q0v7hcapsrjw6biml-interp-lean-chk2"><div class="alectryon-token"><span class="k">#eval</span></div></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message"><span class="mi">3628800</span>
</blockquote></div></div></small></span><span class="alectryon-wsp"><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fact</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → Expr ctx (Ty.fn Ty.int Ty.int)</span></span></div></blockquote></div></small></div>fact</div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>interp</var><b>: </b><span>{x : Nat} → {ctx : Vector Ty x} → {ty : Ty} → Env ctx → Expr ctx ty → Ty.interp ty</span></span></div></blockquote></div></small></div>interp</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Env.nil</var><b>: </b><span>Env Vector.nil</span></span></div></blockquote></div></small></div>Env.nil</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>10</var><b>: </b><span>Ty.interp Ty.int</span></span></div></blockquote></div></small></div><span class="mi">10</span></div><div class="alectryon-token"></div></span></pre></div>
</div>
</div></body>
</html>
