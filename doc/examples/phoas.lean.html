<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="alectryon-standalone" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<title>Parametric Higher-Order Abstract Syntax</title>
<link rel="stylesheet" href="alectryon.css" type="text/css" />
<link rel="stylesheet" href="docutils_basic.css" type="text/css" />
<link rel="stylesheet" href="pygments.css" type="text/css" />
<script type="text/javascript" src="alectryon.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" />
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="alectryon-root alectryon-centered"><div class="alectryon-banner">Built with <a href="https://github.com/cpitclaudel/alectryon/">Alectryon</a>, running Lean4 v4.0.0-unknown. Bubbles (<span class="alectryon-bubble"></span>) indicate interactive fragments: hover for details, tap to reveal contents. Use <kbd>Ctrl+â†‘</kbd> <kbd>Ctrl+â†“</kbd> to navigate, <kbd>Ctrl+ğŸ–±ï¸</kbd> to focus. On Mac, use <kbd>âŒ˜</kbd> instead of <kbd>Ctrl</kbd>.<br>Hover-Settings: Show types:<input id="toggleswitch" type="checkbox" onClick="toggleShowTypes(this);"> Show goals:<input id="toggleswitch" type="checkbox" onClick="toggleShowGoals(this);" checked><br></div><div class="document" id="parametric-higher-order-abstract-syntax">
<h1 class="title">Parametric Higher-Order Abstract Syntax</h1>

<p>In contrast to first-order encodings, higher-order encodings avoid explicit modeling of variable identity.
Instead, the binding constructs of an object language (the language being
formalized) can be represented using the binding constructs of the meta language (the language in which the formalization is done).
The best known higher-order encoding is called higher-order abstract syntax (HOAS),
and we can start by attempting to apply it directly in Lean.</p>
<p>Remark: this example is based on an example in the book [Certified Programming with Dependent Types](<a class="reference external" href="http://adam.chlipala.net/cpdt/">http://adam.chlipala.net/cpdt/</a>) by Adam Chlipala.</p>
<p>Here is the definition of the simple type system for our programming language, a simply typed
lambda calculus with natural numbers as the base type.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">inductive</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">where</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>_root_.Ty</span></span></div></blockquote></div></small></div>nat</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>_root_.Ty â†’ _root_.Ty â†’ _root_.Ty</span></span></div></blockquote></div></small></div>fn</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Sort _tmp_ind_univ_param</span></span></div></blockquote></div></small></div><span class="nv">Ty</span></div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Sort _tmp_ind_univ_param</span></span></div></blockquote></div></small></div><span class="nv">Ty</span></div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Sort _tmp_ind_univ_param</span></span></div></blockquote></div></small></div><span class="nv">Ty</span></div><div class="alectryon-token"></div></span></pre><p>We can write a function to translate <code class="highlight coq"><span class="n">Ty</span></code> values to a Lean type
â€” remember that types are first class, so can be calculated just like any other value.
We mark <code class="highlight coq"><span class="n">Ty</span><span class="o">.</span><span class="n">denote</span></code> as <code class="highlight coq"><span class="o">[</span><span class="n">reducible</span><span class="o">]</span></code> to make sure the typeclass resolution procedure can
unfold/reduce it. For example, suppose Lean is trying to synthesize a value for the instance
<code class="highlight coq"><span class="kn">Add</span> <span class="o">(</span><span class="n">Ty</span><span class="o">.</span><span class="n">denote</span> <span class="n">Ty</span><span class="o">.</span><span class="n">nat</span><span class="o">)</span></code>. Since <code class="highlight coq"><span class="n">Ty</span><span class="o">.</span><span class="n">denote</span></code> is marked as <code class="highlight coq"><span class="o">[</span><span class="n">reducible</span><span class="o">],</span>
<span class="n">the</span> <span class="n">typeclass</span> <span class="n">resolution</span> <span class="n">procedure</span> <span class="n">can</span> <span class="n">reduce</span> <span class="o">`</span><span class="n">Ty</span><span class="o">.</span><span class="n">denote</span> <span class="n">Ty</span><span class="o">.</span><span class="n">nat</span></code> to <code class="highlight coq"><span class="n">Nat</span></code>, and use
the builtin instance for <code class="highlight coq"><span class="kn">Add</span> <span class="n">Nat</span></code> as the solution.</p>
<p>Recall that the term <code class="highlight coq"><span class="n">a</span><span class="o">.</span><span class="n">denote</span></code> is sugar for <code class="highlight coq"><span class="n">denote</span> <span class="n">a</span></code> where <code class="highlight coq"><span class="n">denote</span></code> is the function being defined.
We call it the &quot;dot notation&quot;.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">@[reducible]</span> </div><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.denote</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div>Ty.denote</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</div><div class="alectryon-token">    <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Nat</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Nat</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>Ty â†’ Ty â†’ Ty</span></span></div></blockquote></div></small></div>fn</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">denote</span></div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">denote</span></div><div class="alectryon-token"></div></span></pre><p>With HOAS, each object language binding construct is represented with a function of
the meta language. Here is what we get if we apply that idea within an inductive definition
of term syntax. However a naive encondig in Lean fails to meet the strict positivity restrictions
imposed by the Lean kernel. An alternate higher-order encoding is parametric HOAS, as introduced by Washburn
and Weirich for Haskell and tweaked by Adam Chlipala for use in Coq. The key idea is to parameterize the
declaration by a type family <code class="highlight coq"><span class="n">rep</span></code> standing for a &quot;representation of variables.&quot;</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">inductive</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div>Term&#39;</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></div><div class="alectryon-token">) : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ rep ty â†’ _root_.Term' rep ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token">   : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ _root_.Term' rep Ty.nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Nat</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Nat</div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>nat</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>plus</var><b>: </b><span>{rep : Ty â†’ Type} â†’ _root_.Term' rep Ty.nat â†’ _root_.Term' rep Ty.nat â†’ _root_.Term' rep Ty.nat</span></span></div></blockquote></div></small></div>plus</div><div class="alectryon-token">  : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>nat</div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>nat</div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>nat</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ (rep dom â†’ _root_.Term' rep ran) â†’ _root_.Term' rep (Ty.fn dom ran)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token">   : (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>dom</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">dom</span></div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ran</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ran</span></div><div class="alectryon-token">) <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.fn</var><b>: </b><span>Ty â†’ Ty â†’ Ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>fn</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>dom</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">dom</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ran</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ran</span></div><div class="alectryon-token">)
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ _root_.Term' rep (Ty.fn dom ran) â†’ _root_.Term' rep dom â†’ _root_.Term' rep ran</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token">   : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.fn</var><b>: </b><span>Ty â†’ Ty â†’ Ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>fn</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>dom</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">dom</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ran</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ran</span></div><div class="alectryon-token">) <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>dom</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">dom</span></div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ran</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ran</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Â«letÂ»</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {tyâ‚ tyâ‚‚ : Ty} â†’ _root_.Term' rep tyâ‚ â†’ (rep tyâ‚ â†’ _root_.Term' rep tyâ‚‚) â†’ _root_.Term' rep tyâ‚‚</span></span></div></blockquote></div></small></div><span class="bp">Â«</span><span class="k">let</span><span class="bp">Â»</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>tyâ‚</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">tyâ‚</span></div><div class="alectryon-token"> <span class="bp">â†’</span> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>tyâ‚</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">tyâ‚</span></div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>tyâ‚‚</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">tyâ‚‚</span></div><div class="alectryon-token">) <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">Term&#39;</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>tyâ‚‚</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">tyâ‚‚</span></div><div class="alectryon-token"></div></span></pre><p>Lean accepts this definition because our embedded functions now merely take variables as
arguments, instead of arbitrary terms. One might wonder whether there is an easy loophole
to exploit here, instantiating the parameter <code class="highlight coq"><span class="n">rep</span></code> as term itself. However, to do that, we
would need to choose a variable representation for this nested mention of term, and so on
through an infinite descent into term arguments.</p>
<p>We write the final type of a closed term using polymorphic quantification over all possible
choices of <code class="highlight coq"><span class="n">rep</span></code> type family</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kn">open</span></div><div class="alectryon-token"> Ty Term&#39;

</div><div class="alectryon-token"><span class="kn">namespace</span></div><div class="alectryon-token"> FirstTry

</div><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty â†’ Type 1</span></span></div></blockquote></div></small></div>Term</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token">) := (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></div><div class="alectryon-token">) <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div>Term&#39;</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"></div></span></pre><p>In the next two example, note how each is written as a function over a <code class="highlight coq"><span class="n">rep</span></code> choice,
such that the specific choice has no impact on the structure of the term.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>add</var><b>: </b><span>Term (fn nat (fn nat nat))</span></span></div></blockquote></div></small></div>add</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty â†’ Type 1</span></span></div></blockquote></div></small></div>Term</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>Ty â†’ Ty â†’ Ty</span></span></div></blockquote></div></small></div>fn</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>Ty â†’ Ty â†’ Ty</span></span></div></blockquote></div></small></div>fn</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</div><div class="alectryon-token">)) := </div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span>
  </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ (rep dom â†’ Term' rep ran) â†’ Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep nat</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ (rep dom â†’ Term' rep ran) â†’ Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>y</var><b>: </b><span>rep nat</span></span></div></blockquote></div></small></div><span class="nv">y</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>plus</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Term' rep nat â†’ Term' rep nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>plus</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep nat</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>y</var><b>: </b><span>rep nat</span></span></div></blockquote></div></small></div><span class="nv">y</span></div><div class="alectryon-token">)

</div><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>three_the_hard_way</var><b>: </b><span>Term nat</span></span></div></blockquote></div></small></div>three_the_hard_way</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty â†’ Type 1</span></span></div></blockquote></div></small></div>Term</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</div><div class="alectryon-token"> := </div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span>
  </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ Term' rep (fn dom ran) â†’ Term' rep dom â†’ Term' rep ran</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ Term' rep (fn dom ran) â†’ Term' rep dom â†’ Term' rep ran</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>add</var><b>: </b><span>Term (fn nat (fn nat nat))</span></span></div></blockquote></div></small></div>add</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></div><div class="alectryon-token">)) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>2</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">2</span></div><div class="alectryon-token">)

</div><div class="alectryon-token"><span class="kd">end</span></div><div class="alectryon-token"> FirstTry</div></span></pre><p>The argument <code class="highlight coq"><span class="n">rep</span></code> does not even appear in the function body for <code class="highlight coq"><span class="n">add</span></code>. How can that be?
By giving our terms expressive types, we allow Lean to infer many arguments for us. In fact,
we do not even need to name the <code class="highlight coq"><span class="n">rep</span></code> argument! By using Lean implicit arguments and lambdas,
we can completely hide <code class="highlight coq"><span class="n">rep</span></code> in these examples.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty â†’ Type 1</span></span></div></blockquote></div></small></div>Term</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token">) := {</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></div><div class="alectryon-token">} <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div>Term&#39;</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token">

</div><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>add</var><b>: </b><span>Term (fn nat (fn nat nat))</span></span></div></blockquote></div></small></div>add</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty â†’ Type 1</span></span></div></blockquote></div></small></div>Term</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>Ty â†’ Ty â†’ Ty</span></span></div></blockquote></div></small></div>fn</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>fn</var><b>: </b><span>Ty â†’ Ty â†’ Ty</span></span></div></blockquote></div></small></div>fn</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</div><div class="alectryon-token">)) :=
  </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ (rep dom â†’ Term' rep ran) â†’ Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>repâœ nat</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ (rep dom â†’ Term' rep ran) â†’ Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>y</var><b>: </b><span>repâœ nat</span></span></div></blockquote></div></small></div><span class="nv">y</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>plus</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Term' rep nat â†’ Term' rep nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>plus</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>repâœ nat</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>y</var><b>: </b><span>repâœ nat</span></span></div></blockquote></div></small></div><span class="nv">y</span></div><div class="alectryon-token">)

</div><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>three_the_hard_way</var><b>: </b><span>Term nat</span></span></div></blockquote></div></small></div>three_the_hard_way</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty â†’ Type 1</span></span></div></blockquote></div></small></div>Term</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>nat</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div>nat</div><div class="alectryon-token"> :=
  </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ Term' rep (fn dom ran) â†’ Term' rep dom â†’ Term' rep ran</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ Term' rep (fn dom ran) â†’ Term' rep dom â†’ Term' rep ran</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>add</var><b>: </b><span>Term (fn nat (fn nat nat))</span></span></div></blockquote></div></small></div>add</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></div><div class="alectryon-token">)) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>2</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">2</span></div><div class="alectryon-token">)</div></span></pre><p>It may not be at all obvious that the PHOAS representation admits the crucial computable
operations. The key to effective deconstruction of PHOAS terms is one principle: treat
the <code class="highlight coq"><span class="n">rep</span></code> parameter as an unconstrained choice of which data should be annotated on each
variable. We will begin with a simple example, that of counting how many variable nodes
appear in a PHOAS term. This operation requires no data annotated on variables, so we
simply annotate variables with <code class="highlight coq"><span class="n">Unit</span></code> values. Note that, when we go under binders in the
cases for <code class="highlight coq"><span class="n">lam</span></code> and <code class="highlight coq"><span class="kr">let</span></code>, we must provide the data value to annotate on the new variable we
pass beneath. For our current choice of <code class="highlight coq"><span class="n">Unit</span></code> data, we always pass <code class="highlight coq"><span class="o">()</span></code>.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; Unit) ty â†’ Nat</span></span></div></blockquote></div></small></div>countVars</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div>Term&#39;</div><div class="alectryon-token"> (</div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>_</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>_</div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Unit</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Unit</div><div class="alectryon-token">) </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Nat</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Nat</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>h</var><b>: </b><span>Unit</span></span></div></blockquote></div></small></div><span class="nv">h</span></div><div class="alectryon-token">     <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token">   <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>0</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">0</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>plus</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Term' rep nat â†’ Term' rep nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>plus</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; Unit) nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' (fun x =&gt; Unit) nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token">  <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; Unit) ty â†’ Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; Unit) nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> <span class="bp">+</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; Unit) ty â†’ Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' (fun x =&gt; Unit) nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ Term' rep (fn dom ran) â†’ Term' rep dom â†’ Term' rep ran</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' (fun x =&gt; Unit) (fn ?m.3572 ?ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; Unit) ?m.3572</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">   <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; Unit) ty â†’ Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' (fun x =&gt; Unit) (fn xâœ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token"> <span class="bp">+</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; Unit) ty â†’ Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; Unit) xâœ</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ (rep dom â†’ Term' rep ran) â†’ Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Unit â†’ Term' (fun x =&gt; Unit) ?m.3632</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token">     <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; Unit) ty â†’ Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Unit â†’ Term' (fun x =&gt; Unit) xâœ</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>()</var><b>: </b><span>Unit</span></span></div></blockquote></div></small></div>()</div><div class="alectryon-token">)
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Â«letÂ»</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {tyâ‚ tyâ‚‚ : Ty} â†’ Term' rep tyâ‚ â†’ (rep tyâ‚ â†’ Term' rep tyâ‚‚) â†’ Term' rep tyâ‚‚</span></span></div></blockquote></div></small></div><span class="bp">Â«</span><span class="k">let</span><span class="bp">Â»</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; Unit) ?m.3675</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Unit â†’ Term' (fun x =&gt; Unit) ?ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; Unit) ty â†’ Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; Unit) xâœ</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> <span class="bp">+</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; Unit) ty â†’ Nat</span></span></div></blockquote></div></small></div><span class="nv">countVars</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Unit â†’ Term' (fun x =&gt; Unit) ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> ())</div></span></pre><p>We can now easily prove that <code class="highlight coq"><span class="n">add</span></code> has two variables by using reflexivity</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>example</var><b>: </b><span>countVars add = 2</span></span></div></blockquote></div></small></div><span class="kd">example</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>countVars</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; Unit) ty â†’ Nat</span></span></div></blockquote></div></small></div>countVars</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>add</var><b>: </b><span>Term (fn nat (fn nat nat))</span></span></div></blockquote></div></small></div>add</div><div class="alectryon-token"> <span class="bp">=</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>2</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">2</span></div><div class="alectryon-token"> :=
  </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rfl</var><b>: </b><span>âˆ€ {Î± : Type} {a : Î±}, a = a</span></span></div></blockquote></div></small></div>rfl</div><div class="alectryon-token"></div></span></pre><p>Here is another example, translating PHOAS terms into strings giving a first-order rendering.
To implement this translation, the key insight is to tag variables with strings, giving their names.
The function takes as an additional input <code class="highlight coq"><span class="n">i</span></code> which is used to create variable names for binders.
We also use the string interpolation available in Lean. For example, <code class="highlight coq"><span class="n">s</span><span class="o">!</span><span class="s2">&quot;x_{i}&quot;</span></code> is expanded to
<code class="highlight coq"><span class="s2">&quot;x_&quot;</span> <span class="o">++</span> <span class="n">toString</span> <span class="n">i</span></code>.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; String) ty â†’ optParam Nat 1 â†’ String</span></span></div></blockquote></div></small></div>pretty</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' (fun x =&gt; String) ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div>Term&#39;</div><div class="alectryon-token"> (</div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>_</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>_</div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>String</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>String</div><div class="alectryon-token">) </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Nat</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Nat</div><div class="alectryon-token"> := </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></div><div class="alectryon-token">) : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>String</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>String</div><div class="alectryon-token"> :=
  </div><div class="alectryon-token"><span class="k">match</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' (fun x =&gt; String) ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">with</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>s</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">s</span></div><div class="alectryon-token">     <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>s</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">s</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token">   <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>toString</var><b>: </b><span>{Î± : Type} â†’ [self : ToString Î±] â†’ Î± â†’ String</span></span></div></blockquote></div></small></div>toString</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ Term' rep (fn dom ran) â†’ Term' rep dom â†’ Term' rep ran</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' (fun x =&gt; String) (fn ?m.5391 ?ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; String) ?m.5391</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">   <span class="bp">=&gt;</span> </div><div class="alectryon-token">s<span class="bp">!</span></div><div class="alectryon-token"><span class="s2">&quot;({</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; String) ty â†’ optParam Nat 1 â†’ String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' (fun x =&gt; String) (fn xâœ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></div><div class="alectryon-token">} {</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; String) ty â†’ optParam Nat 1 â†’ String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; String) xâœ</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></div><div class="alectryon-token">})<span class="s2">&quot;</span>
<span class="s2">  |</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>plus</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Term' rep nat â†’ Term' rep nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>plus</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; String) nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' (fun x =&gt; String) nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token">  <span class="bp">=&gt;</span> </div><div class="alectryon-token">s<span class="bp">!</span></div><div class="alectryon-token"><span class="s2">&quot;({</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; String) ty â†’ optParam Nat 1 â†’ String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; String) nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></div><div class="alectryon-token">} <span class="bp">+</span> {</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; String) ty â†’ optParam Nat 1 â†’ String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' (fun x =&gt; String) nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></div><div class="alectryon-token">})<span class="s2">&quot;</span>
<span class="s2">  |</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ (rep dom â†’ Term' rep ran) â†’ Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>String â†’ Term' (fun x =&gt; String) ?m.5650</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token">     <span class="bp">=&gt;</span>
    </div><div class="alectryon-token"><span class="k">let</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> := </div><div class="alectryon-token">s<span class="bp">!</span></div><div class="alectryon-token"><span class="s2">&quot;x_{</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></div><div class="alectryon-token">}<span class="s2">&quot;</span>
    </div><div class="alectryon-token">s<span class="bp">!</span></div><div class="alectryon-token"><span class="s2">&quot;(fun {</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">} <span class="bp">=&gt;</span> {</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; String) ty â†’ optParam Nat 1 â†’ String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>String â†’ Term' (fun x =&gt; String) xâœ</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></div><div class="alectryon-token"><span class="k">+</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></div><div class="alectryon-token">)})<span class="s2">&quot;</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Â«letÂ»</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {tyâ‚ tyâ‚‚ : Ty} â†’ Term' rep tyâ‚ â†’ (rep tyâ‚ â†’ Term' rep tyâ‚‚) â†’ Term' rep tyâ‚‚</span></span></div></blockquote></div></small></div><span class="bp">Â«</span><span class="k">let</span><span class="bp">Â»</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; String) ?m.5875</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>String â†’ Term' (fun x =&gt; String) ?ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span>
    </div><div class="alectryon-token"><span class="k">let</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> := </div><div class="alectryon-token">s<span class="bp">!</span></div><div class="alectryon-token"><span class="s2">&quot;x_{</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></div><div class="alectryon-token">}<span class="s2">&quot;</span>
    </div><div class="alectryon-token">s<span class="bp">!</span></div><div class="alectryon-token"><span class="s2">&quot;(let {</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">} := {</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; String) ty â†’ optParam Nat 1 â†’ String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (fun x =&gt; String) xâœ</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></div><div class="alectryon-token">}<span class="bp">;</span> <span class="bp">=&gt;</span> {</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; String) ty â†’ optParam Nat 1 â†’ String</span></span></div></blockquote></div></small></div><span class="nv">pretty</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>String â†’ Term' (fun x =&gt; String) ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>String</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>i</var><b>: </b><span>optParam Nat 1</span></span></div></blockquote></div></small></div><span class="nv">i</span></div><div class="alectryon-token"><span class="k">+</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>1</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">1</span></div><div class="alectryon-token">)}<span class="s2">&quot;</span></div><div class="alectryon-token">

</div></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk0"><div class="alectryon-token"><span class="k">#eval</span></div></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message"><span class="s2">&quot;(((fun x_1 =&gt; (fun x_2 =&gt; (x_1 + x_2))) 1) 2)&quot;</span>
</blockquote></div></div></small></span><span class="alectryon-wsp"><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; String) ty â†’ optParam Nat 1 â†’ String</span></span></div></blockquote></div></small></div>pretty</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>three_the_hard_way</var><b>: </b><span>Term nat</span></span></div></blockquote></div></small></div>three_the_hard_way</div><div class="alectryon-token">
<span class="c1">-- &quot;(((fun x_1 =&gt; (fun x_2 =&gt; (x_1 + x_2))) 1) 2)&quot;</span></div></span></pre><p>It is not necessary to convert to a different representation to support many common
operations on terms. For instance, we can implement substitution of terms for variables.
The key insight here is to tag variables with terms, so that, on encountering a variable, we
can simply replace it by the term in its tag. We will call this function initially on a term
with exactly one free variable, tagged with the appropriate substitute. During recursion,
new variables are added, but they are only tagged with their own term equivalents. Note
that this function squash is parameterized over a specific <code class="highlight coq"><span class="n">rep</span></code> choice.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' (Term' rep) ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>squash</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div>Term&#39;</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div>Term&#39;</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token">) </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div>Term&#39;</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token">
 <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' rep ?ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></div><div class="alectryon-token">     <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></div><div class="alectryon-token">
 <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token">   <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token">
 <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>plus</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Term' rep nat â†’ Term' rep nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>plus</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (Term' rep) nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' (Term' rep) nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token">  <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>plus</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Term' rep nat â†’ Term' rep nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>plus</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' (Term' rep) ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (Term' rep) nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' (Term' rep) ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' (Term' rep) nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token">)
 <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ (rep dom â†’ Term' rep ran) â†’ Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' rep ?m.7689 â†’ Term' (Term' rep) ?m.7690</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token">     <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ (rep dom â†’ Term' rep ran) â†’ Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep xâœÂ¹</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' (Term' rep) ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' rep xâœÂ¹ â†’ Term' (Term' rep) xâœ</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep xâœÂ¹</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">))
 <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ Term' rep (fn dom ran) â†’ Term' rep dom â†’ Term' rep ran</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' (Term' rep) (fn ?m.7745 ?ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (Term' rep) ?m.7745</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">   <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ Term' rep (fn dom ran) â†’ Term' rep dom â†’ Term' rep ran</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' (Term' rep) ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' (Term' rep) (fn xâœ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' (Term' rep) ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (Term' rep) xâœ</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">)
 <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Â«letÂ»</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {tyâ‚ tyâ‚‚ : Ty} â†’ Term' rep tyâ‚ â†’ (rep tyâ‚ â†’ Term' rep tyâ‚‚) â†’ Term' rep tyâ‚‚</span></span></div></blockquote></div></small></div><span class="bp">Â«</span><span class="k">let</span><span class="bp">Â»</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (Term' rep) ?m.7788</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' rep ?m.7788 â†’ Term' (Term' rep) ?ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Â«letÂ»</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {tyâ‚ tyâ‚‚ : Ty} â†’ Term' rep tyâ‚ â†’ (rep tyâ‚ â†’ Term' rep tyâ‚‚) â†’ Term' rep tyâ‚‚</span></span></div></blockquote></div></small></div><span class="bp">Â«</span><span class="k">let</span><span class="bp">Â»</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' (Term' rep) ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' (Term' rep) xâœ</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">) </div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep xâœ</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' (Term' rep) ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">squash</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' rep xâœ â†’ Term' (Term' rep) ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>.var</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="bp">.</span>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep xâœ</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">))</div></span></pre><p>To define the final substitution function over terms with single free variables, we define
<code class="highlight coq"><span class="n">Term1</span></code>, an analogue to Term that we defined before for closed terms.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term1</var><b>: </b><span>Ty â†’ Ty â†’ Type 1</span></span></div></blockquote></div></small></div>Term1</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty1</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty1</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty2</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty2</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token">) := {</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty</var><b>: </b><span>Type</span></span></div></blockquote></div></small></div>Ty</div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Type</var><b>: </b><span>Type 1</span></span></div></blockquote></div></small></div><span class="kt">Type</span></div><div class="alectryon-token">} <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty1</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty1</span></div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div>Term&#39;</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty2</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty2</span></div><div class="alectryon-token"></div></span></pre><p>Substitution is defined by (1) instantiating a <code class="highlight coq"><span class="n">Term1</span></code> to tag variables with terms and (2)
applying the result to a specific term to be substituted. Note how the parameter <code class="highlight coq"><span class="n">rep</span></code> of
<code class="highlight coq"><span class="n">squash</span></code> is instantiated: the body of <code class="highlight coq"><span class="nb">subst</span></code> is itself a polymorphic quantification over <code class="highlight coq"><span class="n">rep</span></code>,
standing for a variable tag choice in the output term; and we use that input to compute a
tag choice for the input term.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>subst</var><b>: </b><span>{ty1 ty2 : Ty} â†’ Term1 ty1 ty2 â†’ Term ty1 â†’ Term ty2</span></span></div></blockquote></div></small></div>subst</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term1 ty1 ty2</span></span></div></blockquote></div></small></div><span class="nv">e</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term1</var><b>: </b><span>Ty â†’ Ty â†’ Type 1</span></span></div></blockquote></div></small></div>Term1</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty1</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty1</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty2</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty2</span></div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e'</var><b>: </b><span>Term ty1</span></span></div></blockquote></div></small></div><span class="nv">e&#39;</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty â†’ Type 1</span></span></div></blockquote></div></small></div>Term</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty1</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty1</span></div><div class="alectryon-token">) : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term</var><b>: </b><span>Ty â†’ Type 1</span></span></div></blockquote></div></small></div>Term</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty2</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty2</span></div><div class="alectryon-token"> :=
  </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>squash</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' (Term' rep) ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>squash</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term1 ty1 ty2</span></span></div></blockquote></div></small></div><span class="nv">e</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e'</var><b>: </b><span>Term ty1</span></span></div></blockquote></div></small></div><span class="nv">e&#39;</span></div><div class="alectryon-token">)</div></span></pre><p>We can view <code class="highlight coq"><span class="n">Term1</span></code> as a term with hole. In the following example,
<code class="highlight coq"><span class="o">(</span><span class="kr">fun</span> <span class="nv">x</span> <span class="o">=&gt;</span> <span class="n">plus</span> <span class="o">(</span><span class="n">var</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">const</span> <span class="mi">5</span><span class="o">))</span></code> can be viewed as the term <code class="highlight coq"><span class="n">plus</span> <span class="n">_</span> <span class="o">(</span><span class="n">const</span> <span class="mi">5</span><span class="o">)</span></code> where
the hole <code class="highlight coq"><span class="n">_</span></code> is instantiated by <code class="highlight coq"><span class="nb">subst</span></code> with <code class="highlight coq"><span class="n">three_the_hard_way</span></code></p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk1"><div class="alectryon-token"><span class="k">#eval</span></div></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message"><span class="s2">&quot;((((fun x_1 =&gt; (fun x_2 =&gt; (x_1 + x_2))) 1) 2) + 5)&quot;</span>
</blockquote></div></div></small></span><span class="alectryon-wsp"><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>pretty</var><b>: </b><span>{ty : Ty} â†’ Term' (fun x =&gt; String) ty â†’ optParam Nat 1 â†’ String</span></span></div></blockquote></div></small></div>pretty</div><div class="alectryon-token"> <span class="bp">&lt;|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>subst</var><b>: </b><span>{ty1 ty2 : Ty} â†’ Term1 ty1 ty2 â†’ Term ty1 â†’ Term ty2</span></span></div></blockquote></div></small></div>subst</div><div class="alectryon-token"> (</div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>repâœ nat</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>plus</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Term' rep nat â†’ Term' rep nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>plus</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>repâœ nat</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>5</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="mi">5</span></div><div class="alectryon-token">)) </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>three_the_hard_way</var><b>: </b><span>Term nat</span></span></div></blockquote></div></small></div>three_the_hard_way</div><div class="alectryon-token"></div></span></pre><p>One further development, which may seem surprising at first,
is that we can also implement a usual term denotation function,
when we tag variables with their denotations.</p>
<p>The attribute <code class="highlight coq"><span class="o">[</span><span class="n">simp</span><span class="o">]</span></code> instructs Lean to always try to unfold <code class="highlight coq"><span class="n">denote</span></code> applications when one applies
the <code class="highlight coq"><span class="n">simp</span></code> tactic. We also say this is a hint for the Lean term simplifier.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="bp">@</span>[</div><div class="alectryon-token"><span class="k">simp</span></div><div class="alectryon-token">] </div><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} â†’ Term' Ty.denote ty â†’ Ty.denote ty</span></span></div></blockquote></div></small></div>denote</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div>Term&#39;</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.denote</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div>Ty.denote</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"><span class="bp">.</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div>denote</div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Ty.denote ?ty</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">     <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token">   <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>plus</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Term' rep nat â†’ Term' rep nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>plus</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' Ty.denote nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' Ty.denote nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token">  <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} â†’ Term' Ty.denote ty â†’ Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' Ty.denote nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> <span class="bp">+</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} â†’ Term' Ty.denote ty â†’ Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' Ty.denote nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ Term' rep (fn dom ran) â†’ Term' rep dom â†’ Term' rep ran</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' Ty.denote (fn ?m.9399 ?ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' Ty.denote ?m.9399</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">   <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} â†’ Term' Ty.denote ty â†’ Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' Ty.denote (fn xâœ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} â†’ Term' Ty.denote ty â†’ Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' Ty.denote xâœ</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">)
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ (rep dom â†’ Term' rep ran) â†’ Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Ty.denote ?m.9454 â†’ Term' Ty.denote ?m.9455</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token">     <span class="bp">=&gt;</span> </div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Ty.denote xâœÂ¹</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} â†’ Term' Ty.denote ty â†’ Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Ty.denote xâœÂ¹ â†’ Term' Ty.denote xâœ</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>Ty.denote xâœÂ¹</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">)
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Â«letÂ»</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {tyâ‚ tyâ‚‚ : Ty} â†’ Term' rep tyâ‚ â†’ (rep tyâ‚ â†’ Term' rep tyâ‚‚) â†’ Term' rep tyâ‚‚</span></span></div></blockquote></div></small></div><span class="bp">Â«</span><span class="k">let</span><span class="bp">Â»</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' Ty.denote ?m.9559</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Ty.denote ?m.9559 â†’ Term' Ty.denote ?ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} â†’ Term' Ty.denote ty â†’ Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Ty.denote xâœ â†’ Term' Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} â†’ Term' Ty.denote ty â†’ Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">denote</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' Ty.denote xâœ</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">))

</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>example</var><b>: </b><span>_root_.denote three_the_hard_way = 3</span></span></div></blockquote></div></small></div><span class="kd">example</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} â†’ Term' Ty.denote ty â†’ Ty.denote ty</span></span></div></blockquote></div></small></div>denote</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>three_the_hard_way</var><b>: </b><span>Term nat</span></span></div></blockquote></div></small></div>three_the_hard_way</div><div class="alectryon-token"> <span class="bp">=</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>3</var><b>: </b><span>Ty.denote nat</span></span></div></blockquote></div></small></div><span class="mi">3</span></div><div class="alectryon-token"> :=
  </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rfl</var><b>: </b><span>âˆ€ {Î± : Type} {a : Î±}, a = a</span></span></div></blockquote></div></small></div>rfl</div><div class="alectryon-token"></div></span></pre><p>To summarize, the PHOAS representation has all the expressive power of more
standard encodings (e.g., using de Bruijn indices), and a variety of translations are actually much more pleasant to
implement than usual, thanks to the novel ability to tag variables with data.</p>
<p>We now define the constant folding optimization that traverses a term if replaces subterms such as
<code class="highlight coq"><span class="n">plus</span> <span class="o">(</span><span class="n">const</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">const</span> <span class="n">n</span><span class="o">)</span></code> with <code class="highlight coq"><span class="n">const</span> <span class="o">(</span><span class="n">n</span><span class="o">+</span><span class="n">m</span><span class="o">)</span></code>.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="bp">@</span>[</div><div class="alectryon-token"><span class="k">simp</span></div><div class="alectryon-token">] </div><div class="alectryon-token"><span class="kd">def</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>constFold</div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div>Term&#39;</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token"> <span class="bp">â†’</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div>Term&#39;</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>rep</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div><span class="nv">rep</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep ?ty</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">     <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>var</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>var</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep ty</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token">   <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token">
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ Term' rep (fn dom ran) â†’ Term' rep dom â†’ Term' rep ran</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' rep (fn ?m.15735 ?ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' rep ?m.15735</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">   <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>app</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ Term' rep (fn dom ran) â†’ Term' rep dom â†’ Term' rep ran</span></span></div></blockquote></div></small></div>app</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>Term' rep (fn xâœ ty)</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token">) (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' rep xâœ</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">)
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ (rep dom â†’ Term' rep ran) â†’ Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>rep ?m.15779 â†’ Term' rep ?m.15780</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token">     <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>lam</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {dom ran : Ty} â†’ (rep dom â†’ Term' rep ran) â†’ Term' rep (fn dom ran)</span></span></div></blockquote></div></small></div>lam</div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep xâœÂ¹</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>f</var><b>: </b><span>rep xâœÂ¹ â†’ Term' rep xâœ</span></span></div></blockquote></div></small></div><span class="nv">f</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep xâœÂ¹</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">)
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Â«letÂ»</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {tyâ‚ tyâ‚‚ : Ty} â†’ Term' rep tyâ‚ â†’ (rep tyâ‚ â†’ Term' rep tyâ‚‚) â†’ Term' rep tyâ‚‚</span></span></div></blockquote></div></small></div><span class="bp">Â«</span><span class="k">let</span><span class="bp">Â»</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' rep ?m.15830</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>rep ?m.15830 â†’ Term' rep ?ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Â«letÂ»</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {tyâ‚ tyâ‚‚ : Ty} â†’ Term' rep tyâ‚ â†’ (rep tyâ‚ â†’ Term' rep tyâ‚‚) â†’ Term' rep tyâ‚‚</span></span></div></blockquote></div></small></div><span class="bp">Â«</span><span class="k">let</span><span class="bp">Â»</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' rep xâœ</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">) </div><div class="alectryon-token"><span class="k">fun</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep xâœ</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>rep xâœ â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>x</var><b>: </b><span>rep xâœ</span></span></div></blockquote></div></small></div><span class="nv">x</span></div><div class="alectryon-token">)
  <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>plus</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Term' rep nat â†’ Term' rep nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>plus</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token">  <span class="bp">=&gt;</span>
    </div><div class="alectryon-token"><span class="k">match</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">a</span></div><div class="alectryon-token">, </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div><span class="nv">constFold</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">b</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">with</span></div><div class="alectryon-token">
    <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token">, </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>m</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">m</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>const</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>const</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>n</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">n</span></div><div class="alectryon-token"><span class="bp">+</span></div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>m</var><b>: </b><span>Nat</span></span></div></blockquote></div></small></div><span class="nv">m</span></div><div class="alectryon-token">)
    <span class="bp">|</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a'</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">a&#39;</span></div><div class="alectryon-token">,      </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b'</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">b&#39;</span></div><div class="alectryon-token">      <span class="bp">=&gt;</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>plus</var><b>: </b><span>{rep : Ty â†’ Type} â†’ Term' rep nat â†’ Term' rep nat â†’ Term' rep nat</span></span></div></blockquote></div></small></div>plus</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>a'</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">a&#39;</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>b'</var><b>: </b><span>Term' rep nat</span></span></div></blockquote></div></small></div><span class="nv">b&#39;</span></div><div class="alectryon-token"></div></span></pre><p>The correctness of the <code class="highlight coq"><span class="n">constFold</span></code> is proved using induction, case-analysis, and the term simplifier.
We prove all cases but the one for <code class="highlight coq"><span class="n">plus</span></code> using <code class="highlight coq"><span class="n">simp</span> <span class="o">[*]</span></code>. This tactic instructs the term simplifier to
use hypotheses such as <code class="highlight coq"><span class="n">a</span> <span class="o">=</span> <span class="n">b</span></code> as rewriting/simplications rules.
We use the <code class="highlight coq"><span class="nb">split</span></code> to break the nested <code class="highlight coq"><span class="kr">match</span></code> expression in the <code class="highlight coq"><span class="n">plus</span></code> case into two cases.
The local variables <code class="highlight coq"><span class="n">iha</span></code> and <code class="highlight coq"><span class="n">ihb</span></code> are the induction hypotheses for <code class="highlight coq"><span class="n">a</span></code> and <code class="highlight coq"><span class="n">b</span></code>.
The modifier <code class="highlight coq"><span class="o">â†</span></code> in a term simplifier argument instructs the term simplier to use the equation as a rewriting rule in
the &quot;reverse direction. That is, given <code class="highlight coq"><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="o">=</span> <span class="n">b</span></code>, <code class="highlight coq"><span class="o">â†</span> <span class="n">h</span></code> instructs the term simplifier to rewrite <code class="highlight coq"><span class="n">b</span></code> subterms to <code class="highlight coq"><span class="n">a</span></code>.</p>
<pre class="alectryon-io type-info-hidden highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><div class="alectryon-token"><span class="kd">theorem</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold_sound</var><b>: </b><span>âˆ€ {ty : Ty} (e : Term' Ty.denote ty), _root_.denote (constFold e) = _root_.denote e</span></span></div></blockquote></div></small></div>constFold_sound</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></div><div class="alectryon-token"> : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Term'</var><b>: </b><span>(Ty â†’ Type) â†’ Ty â†’ Type</span></span></div></blockquote></div></small></div>Term&#39;</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>Ty.denote</var><b>: </b><span>Ty â†’ Type</span></span></div></blockquote></div></small></div>Ty.denote</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ty</var><b>: </b><span>Ty</span></span></div></blockquote></div></small></div><span class="nv">ty</span></div><div class="alectryon-token">) : </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} â†’ Term' Ty.denote ty â†’ Ty.denote ty</span></span></div></blockquote></div></small></div>denote</div><div class="alectryon-token"> (</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>constFold</var><b>: </b><span>{rep : Ty â†’ Type} â†’ {ty : Ty} â†’ Term' rep ty â†’ Term' rep ty</span></span></div></blockquote></div></small></div>constFold</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></div><div class="alectryon-token">) <span class="bp">=</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>denote</var><b>: </b><span>{ty : Ty} â†’ Term' Ty.denote ty â†’ Ty.denote ty</span></span></div></blockquote></div></small></div>denote</div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></div><div class="alectryon-token"> := </div></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk2"><div class="alectryon-token"><span class="kd">by</span></div><div class="alectryon-token"></div></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote ty</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">_root_.denote (constFold e) <span class="bp">=</span> _root_.denote e</div></blockquote></div></div></small></span><span class="alectryon-wsp"><div class="alectryon-token">
  </div></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk3"><div class="alectryon-token"><span class="k">induction</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>e</var><b>: </b><span>Term' Ty.denote ty</span></span></div></blockquote></div></small></div><span class="nv">e</span></div><div class="alectryon-token"> </div><div class="alectryon-token"><span class="k">with</span></div><div class="alectryon-token"></div></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote ty</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">_root_.denote (constFold e) <span class="bp">=</span> _root_.denote e</div></blockquote></div></div></small></span><span class="alectryon-wsp"><div class="alectryon-token"> </div></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk4"><div class="alectryon-token"><span class="k">simp</span></div><div class="alectryon-token"> [<span class="bp">*</span>]</div></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">Goals accomplished<span class="bp">!</span> <span class="bp">ğŸ™</span></div></blockquote></div></div></small></span><span class="alectryon-wsp"><div class="alectryon-token">
  </div></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk5"><div class="alectryon-token"><span class="bp">|</span> plus a b iha ihb <span class="bp">=&gt;</span></div></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>a, b</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>iha</var><span class="hyp-type"><b>: </b><span>_root_.denote (constFold a) <span class="bp">=</span> _root_.denote a</span></span></span><br><span><var>ihb</var><span class="hyp-type"><b>: </b><span>_root_.denote (constFold b) <span class="bp">=</span> _root_.denote b</span></span></span><br></div><span class="goal-separator"><hr><span class="goal-name">plus</span></span><div class="goal-conclusion">_root_.denote
    (<span class="k">match</span> constFold a, constFold b <span class="k">with</span>
    <span class="bp">|</span> const n, const m <span class="bp">=&gt;</span> const (n <span class="bp">+</span> m)
    <span class="bp">|</span> a&#39;, b&#39; <span class="bp">=&gt;</span> plus a&#39; b&#39;) <span class="bp">=</span>
  _root_.denote a <span class="bp">+</span> _root_.denote b</div></blockquote></div></div></small></span><span class="alectryon-wsp"><div class="alectryon-token">
    </div></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk6"><div class="alectryon-token"><span class="k">split</span></div></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>a, b</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>iha</var><span class="hyp-type"><b>: </b><span>_root_.denote (constFold a) <span class="bp">=</span> _root_.denote a</span></span></span><br><span><var>ihb</var><span class="hyp-type"><b>: </b><span>_root_.denote (constFold b) <span class="bp">=</span> _root_.denote b</span></span></span><br><span><var>nâœ, mâœ</var><span class="hyp-type"><b>: </b><span>Nat</span></span></span><br></div><span class="goal-separator"><hr><span class="goal-name">plus.h_1</span></span><div class="goal-conclusion">_root_.denote (const (n<span class="bp">âœ</span> <span class="bp">+</span> m<span class="bp">âœ</span>)) <span class="bp">=</span> _root_.denote a <span class="bp">+</span> _root_.denote b</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk7" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>a, b</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>iha</var><span class="hyp-type"><b>: </b><span>_root_.denote (constFold a) <span class="bp">=</span> _root_.denote a</span></span></span><br><span><var>ihb</var><span class="hyp-type"><b>: </b><span>_root_.denote (constFold b) <span class="bp">=</span> _root_.denote b</span></span></span><br></div><label class="goal-separator" for="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk7"><hr><span class="goal-name">plus.h_2</span></label><div class="goal-conclusion">_root_.denote (plus (constFold a) (constFold b)) <span class="bp">=</span> _root_.denote a <span class="bp">+</span> _root_.denote b</div></blockquote></div></div></div></small></span><span class="alectryon-wsp"><div class="alectryon-token">
    </div></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk8"><div class="alectryon-token"><span class="k">next</span></div><div class="alectryon-token"> heâ‚ heâ‚‚ <span class="bp">=&gt;</span></div></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>a, b</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>iha</var><span class="hyp-type"><b>: </b><span>_root_.denote (constFold a) <span class="bp">=</span> _root_.denote a</span></span></span><br><span><var>ihb</var><span class="hyp-type"><b>: </b><span>_root_.denote (constFold b) <span class="bp">=</span> _root_.denote b</span></span></span><br><span><var>nâœ, mâœ</var><span class="hyp-type"><b>: </b><span>Nat</span></span></span><br></div><span class="goal-separator"><hr><span class="goal-name">plus.h_1</span></span><div class="goal-conclusion">_root_.denote (const (n<span class="bp">âœ</span> <span class="bp">+</span> m<span class="bp">âœ</span>)) <span class="bp">=</span> _root_.denote a <span class="bp">+</span> _root_.denote b</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk9" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>a, b</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>iha</var><span class="hyp-type"><b>: </b><span>_root_.denote (constFold a) <span class="bp">=</span> _root_.denote a</span></span></span><br><span><var>ihb</var><span class="hyp-type"><b>: </b><span>_root_.denote (constFold b) <span class="bp">=</span> _root_.denote b</span></span></span><br></div><label class="goal-separator" for="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chk9"><hr><span class="goal-name">plus.h_2</span></label><div class="goal-conclusion">_root_.denote (plus (constFold a) (constFold b)) <span class="bp">=</span> _root_.denote a <span class="bp">+</span> _root_.denote b</div></blockquote></div></div></div></small></span><span class="alectryon-wsp"><div class="alectryon-token"> </div></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chka"><div class="alectryon-token"><span class="k">simp</span></div><div class="alectryon-token"> [<span class="bp">â†</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>iha</var><b>: </b><span>_root_.denote (constFold a) = _root_.denote a</span></span></div></blockquote></div></small></div><span class="nv">iha</span></div><div class="alectryon-token">, <span class="bp">â†</span> </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ihb</var><b>: </b><span>_root_.denote (constFold b) = _root_.denote b</span></span></div></blockquote></div></small></div><span class="nv">ihb</span></div><div class="alectryon-token">, </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>heâ‚</var><b>: </b><span>constFold a = const nâœ</span></span></div></blockquote></div></small></div><span class="nv">heâ‚</span></div><div class="alectryon-token">, </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>heâ‚‚</var><b>: </b><span>constFold b = const mâœ</span></span></div></blockquote></div></small></div><span class="nv">heâ‚‚</span></div><div class="alectryon-token">]</div></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">Goals accomplished<span class="bp">!</span> <span class="bp">ğŸ™</span></div></blockquote></div></div></small></span><span class="alectryon-wsp"><div class="alectryon-token">
    </div></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chkb"><div class="alectryon-token"><span class="k">next</span></div><div class="alectryon-token"> <span class="bp">=&gt;</span></div></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>ty</var><span class="hyp-type"><b>: </b><span>Ty</span></span></span><br><span><var>a, b</var><span class="hyp-type"><b>: </b><span>Term&#39; Ty.denote nat</span></span></span><br><span><var>iha</var><span class="hyp-type"><b>: </b><span>_root_.denote (constFold a) <span class="bp">=</span> _root_.denote a</span></span></span><br><span><var>ihb</var><span class="hyp-type"><b>: </b><span>_root_.denote (constFold b) <span class="bp">=</span> _root_.denote b</span></span></span><br></div><span class="goal-separator"><hr><span class="goal-name">plus.h_2</span></span><div class="goal-conclusion">_root_.denote (plus (constFold a) (constFold b)) <span class="bp">=</span> _root_.denote a <span class="bp">+</span> _root_.denote b</div></blockquote></div></div></small></span><span class="alectryon-wsp"><div class="alectryon-token"> </div></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="bnnn0jpgh9hja614xk802bniycx2y99w-phoas-lean-chkc"><div class="alectryon-token"><span class="k">simp</span></div><div class="alectryon-token"> [</div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>iha</var><b>: </b><span>_root_.denote (constFold a) = _root_.denote a</span></span></div></blockquote></div></small></div><span class="nv">iha</span></div><div class="alectryon-token">, </div><div class="alectryon-token"><div class="alectryon-type-info-wrapper"><small class="alectryon-type-info"><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span class="hyp-type"><var>ihb</var><b>: </b><span>_root_.denote (constFold b) = _root_.denote b</span></span></div></blockquote></div></small></div><span class="nv">ihb</span></div><div class="alectryon-token">]</div></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">Goals accomplished<span class="bp">!</span> <span class="bp">ğŸ™</span></div></blockquote></div></div></small></span></pre>
</div>
</div></body>
</html>
